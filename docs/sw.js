const CACHE_NAME="story-app-cache-v10",urlsToCache=["./","./index.html","./offline.html","./app.bundle.js","./images/logo.png"];self.addEventListener("install",(t=>{console.log("[SW] Install event"),t.waitUntil(caches.open(CACHE_NAME).then((t=>t.addAll(urlsToCache))))})),self.addEventListener("activate",(t=>{console.log("[SW] Activate event"),t.waitUntil(caches.keys().then((t=>Promise.all(t.filter((t=>t!==CACHE_NAME)).map((t=>caches.delete(t)))))))})),self.addEventListener("fetch",(t=>{const e=t.request;"navigate"!==e.mode?"POST"===e.method&&e.url.includes("/api/")?t.respondWith(fetch(e.clone()).then((t=>("granted"===Notification.permission?self.registration.showNotification("Story App",{body:"Data berhasil dikirim ke server!",icon:"./images/logo.png",badge:"./images/logo.png",vibrate:[100,50,100]}):console.warn("[SW] Notifikasi tidak diizinkan, skip showNotification"),t))).catch((t=>(console.error("[SW] POST gagal:",t),new Response(JSON.stringify({error:"Tidak bisa kirim data"}),{status:500,headers:{"Content-Type":"application/json"}}))))):t.respondWith(caches.match(e).then((t=>t||fetch(e)))):t.respondWith(fetch(e).catch((()=>caches.match("./offline.html"))))})),self.addEventListener("push",(t=>{console.log("[SW] Push event:",t);let e={};if(t.data)try{e=t.data.json()}catch{e={title:"Story App",message:t.data.text(),url:"./"}}const i={body:e.message||"Anda mendapat notifikasi baru!",icon:"./images/logo.png",badge:"./images/logo.png",vibrate:[100,50,100],data:{url:e.url||"./"},actions:[{action:"open",title:"Buka Aplikasi"},{action:"close",title:"Tutup"}]};"granted"===Notification.permission?t.waitUntil(self.registration.showNotification(e.title||"Story App",i)):console.warn("[SW] Push diterima tapi notifikasi tidak diizinkan user")})),self.addEventListener("notificationclick",(t=>{t.notification.close(),"open"===t.action&&t.notification.data?.url?t.waitUntil(clients.openWindow(t.notification.data.url)):"close"===t.action||t.waitUntil(clients.openWindow("./"))}));